{"version":3,"file":"NewCommentForm-DWFfvpJu.js","sources":["../../src/components/Comments/NewCommentForm.tsx"],"sourcesContent":["import { Button, Field, Textarea } from \"@fluentui/react-components\";\nimport { useForm } from \"@tanstack/react-form\";\nimport { type } from \"arktype\";\nimport { useFormInitQuery } from \"../../hooks/useFormInitQuery\";\nimport dayjs from \"dayjs\";\nimport type { Comment } from \"../../types\";\nimport { CommentAddRegular } from \"@fluentui/react-icons\";\nimport { useTranslation } from \"react-i18next\";\nimport { useFieldContext } from \"../../hooks/formContext\";\nimport { useWfgFormContext } from \"../../hooks/useWfgFormContext\";\n\nfunction View() {\n    const { t } = useTranslation();\n    const { currentUser, configuration } = useFormInitQuery();\n    const comments = useFieldContext<Comment[]>();\n    const commentForm = useForm({\n        defaultValues: {\n            comment: ''\n        },\n        validators: {\n            onSubmit: type({\n                comment: \"string > 5\"\n            })\n        }\n    });\n    \n    return (\n        <commentForm.Field\n            name=\"comment\"\n            children={(field) => {\n                const addComment = async () => {\n                    const validationErrors = await commentForm.validateField(\"comment\", \"submit\");\n                    if (validationErrors.length < 1) {\n                        comments.insertValue(0, {\n                            Type: \"COMMENT\",\n                            Author: currentUser.CommonName!,\n                            UserName: currentUser.UserName!,\n                            Directory: currentUser.Directory!,\n                            Created: dayjs().toISOString(),\n                            ProcessInstId: configuration.WF_PROCESS_INST_ID,\n                            ProcessName: configuration.WF_PROCESS_NAME,\n                            ActivityInstId: configuration.WF_ACTIVITY_INST_ID,\n                            ActivityName: configuration.WF_ACTIVITY_NAME,\n                            Comment: field.state.value\n                        });\n                        commentForm.reset();\n                    }\n                };\n                return (<>\n                    <div className=\"\">\n                        <Field \n                            hint={t('Shift-Enter for a new line')} \n                            validationMessage={field.state.meta.isTouched && field.state.meta.errors.length > 0 ? t(field.state.meta.errors.join(', '), { field: '', length: 6, actual: field.state.value.length }) : null}\n                        >\n                            <Textarea\n                                resize=\"vertical\"\n                                onKeyDown={event => {\n                                    if (event.key === \"Enter\") {\n                                        if (!event.shiftKey) {\n                                            event.preventDefault();\n                                            addComment();\n                                        }\n                                    }\n                                }}\n                                value={field.state.value}\n                                onChange={(e) => field.handleChange(e.target.value)}\n                            />\n                        </Field>\n                        <commentForm.Subscribe\n                            selector={(state) => [state.canSubmit, state.isSubmitting]}\n                            children={([canSubmit, isSubmitting]) => (\n                                <Button\n                                    disabled={!canSubmit || isSubmitting}\n                                    appearance=\"transparent\"\n                                    icon={<CommentAddRegular />}\n                                    onClick={addComment}\n                                >\n                                    {t('Add Comment')}\n                                </Button>\n                            )}\n                        />\n                    </div>\n                </>);\n            }}\n        />\n    );\n};\n\nexport default () => {\n    const { isArchive } = useFormInitQuery();\n    const { printForm: { state: { values: { open: isPrintView } } } } = useWfgFormContext();\n    return !isArchive && !isPrintView ? <View /> : null;\n}"],"names":["View","t","useTranslation","currentUser","configuration","useFormInitQuery","comments","useFieldContext","commentForm","useForm","type","jsx","field","addComment","dayjs","Fragment","jsxs","Field","Textarea","event","state","canSubmit","isSubmitting","Button","CommentAddRegular","NewCommentForm","isArchive","isPrintView","useWfgFormContext"],"mappings":"yHAWA,SAASA,GAAO,CACN,KAAA,CAAE,EAAAC,CAAE,EAAIC,EAAe,EACvB,CAAE,YAAAC,EAAa,cAAAC,CAAc,EAAIC,EAAiB,EAClDC,EAAWC,EAA2B,EACtCC,EAAcC,EAAQ,CACxB,cAAe,CACX,QAAS,EACb,EACA,WAAY,CACR,SAAUC,EAAK,CACX,QAAS,YACZ,CAAA,CAAA,CACL,CACH,EAGG,OAAAC,EAAA,IAACH,EAAY,MAAZ,CACG,KAAK,UACL,SAAWI,GAAU,CACjB,MAAMC,EAAa,SAAY,EACF,MAAML,EAAY,cAAc,UAAW,QAAQ,GACvD,OAAS,IAC1BF,EAAS,YAAY,EAAG,CACpB,KAAM,UACN,OAAQH,EAAY,WACpB,SAAUA,EAAY,SACtB,UAAWA,EAAY,UACvB,QAASW,EAAM,EAAE,YAAY,EAC7B,cAAeV,EAAc,mBAC7B,YAAaA,EAAc,gBAC3B,eAAgBA,EAAc,oBAC9B,aAAcA,EAAc,iBAC5B,QAASQ,EAAM,MAAM,KAAA,CACxB,EACDJ,EAAY,MAAM,EAE1B,EACA,OACIG,EAAA,IAAAI,WAAA,CAAA,SAAAC,EAAAA,KAAC,MAAI,CAAA,UAAU,GACX,SAAA,CAAAL,EAAA,IAACM,EAAA,CACG,KAAMhB,EAAE,4BAA4B,EACpC,kBAAmBW,EAAM,MAAM,KAAK,WAAaA,EAAM,MAAM,KAAK,OAAO,OAAS,EAAIX,EAAEW,EAAM,MAAM,KAAK,OAAO,KAAK,IAAI,EAAG,CAAE,MAAO,GAAI,OAAQ,EAAG,OAAQA,EAAM,MAAM,MAAM,MAAA,CAAQ,EAAI,KAE1L,SAAAD,EAAA,IAACO,EAAA,CACG,OAAO,WACP,UAAoBC,GAAA,CACZA,EAAM,MAAQ,UACTA,EAAM,WACPA,EAAM,eAAe,EACVN,EAAA,GAGvB,EACA,MAAOD,EAAM,MAAM,MACnB,SAAW,GAAMA,EAAM,aAAa,EAAE,OAAO,KAAK,CAAA,CAAA,CACtD,CACJ,EACAD,EAAA,IAACH,EAAY,UAAZ,CACG,SAAWY,GAAU,CAACA,EAAM,UAAWA,EAAM,YAAY,EACzD,SAAU,CAAC,CAACC,EAAWC,CAAY,IAC/BX,EAAA,IAACY,EAAA,CACG,SAAU,CAACF,GAAaC,EACxB,WAAW,cACX,WAAOE,EAAkB,EAAA,EACzB,QAASX,EAER,WAAE,aAAa,CAAA,CAAA,CACpB,CAAA,CAER,CAAA,CACJ,CACJ,CAAA,CAAA,CACJ,CACJ,CAER,CAEA,MAAAY,EAAe,IAAM,CACX,KAAA,CAAE,UAAAC,CAAU,EAAIrB,EAAiB,EACjC,CAAE,UAAW,CAAE,MAAO,CAAE,OAAQ,CAAE,KAAMsB,CAAY,CAAA,IAAUC,EAAkB,EACtF,MAAO,CAACF,GAAa,CAACC,EAAchB,EAAA,IAACX,GAAK,CAAA,EAAK,IACnD"}